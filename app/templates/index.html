{% extends "base.html" %}

{% block content %}
<div class="grid">
    <section class="card">
        <h2>Process Audio</h2>

        <form id="process-form" hx-post="/process" hx-target="#preview-area" hx-swap="innerHTML">
            <div class="form-group">
                <label for="input_file">Source File</label>
                <select name="input_file" id="input_file" required>
                    <option value="">Select a file...</option>
                    {% for file in input_files %}
                    <option value="{{ file.name }}">{{ file.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- URL Download Section -->
            <div class="url-section">
                <div class="section-divider">
                    <span>or download from URL</span>
                </div>

                <div class="url-input-group">
                    <input type="text"
                           id="download_url"
                           name="download_url"
                           placeholder="Paste video URL (YouTube, Twitch, Twitter, TikTok, etc.)"
                           class="url-input">
                    <button type="button"
                            class="btn-download"
                            hx-post="/download/validate"
                            hx-include="#download_url"
                            hx-target="#download-status"
                            hx-swap="innerHTML">
                        <span class="btn-text">Check URL</span>
                        <span class="htmx-indicator">Checking...</span>
                    </button>
                </div>

                <div id="download-status"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="start_time">Start Time</label>
                    <input type="text" name="start_time" id="start_time" value="00:00:00" pattern="[0-9]{2}:[0-9]{2}:[0-9]{2}(\.[0-9]+)?" placeholder="HH:MM:SS">
                </div>
                <div class="form-group">
                    <label for="end_time">End Time</label>
                    <input type="text" name="end_time" id="end_time" value="00:00:06" pattern="[0-9]{2}:[0-9]{2}:[0-9]{2}(\.[0-9]+)?" placeholder="HH:MM:SS">
                </div>
            </div>

            <div class="form-group">
                <label>Preset</label>
                <div class="preset-buttons">
                    {% for level, config in presets %}
                    <button type="button"
                            class="preset-btn {% if level == 'medium' %}active{% endif %}"
                            data-preset="{{ level }}"
                            hx-get="/partials/sliders?preset={{ level }}"
                            hx-target="#sliders-area"
                            hx-swap="innerHTML"
                            onclick="selectPreset(this, '{{ level }}')">
                        <strong>{{ config.name }}</strong>
                        <small>{{ config.description }}</small>
                    </button>
                    {% endfor %}
                </div>
                <input type="hidden" name="preset" id="preset" value="medium">
            </div>

            <div id="sliders-area">
                {% include "partials/slider_form.html" %}
            </div>

            <button type="submit" class="btn-primary">
                <span class="htmx-indicator">Processing...</span>
                <span class="btn-text">Process Audio</span>
            </button>
        </form>
    </section>

    <section class="card">
        <h2>Preview</h2>
        <div id="preview-area">
            <p class="placeholder">Processed audio will appear here</p>
        </div>

        <h2>History</h2>
        <div id="history-area" hx-get="/history" hx-trigger="load" hx-swap="innerHTML">
            <p class="placeholder">Loading history...</p>
        </div>
    </section>
</div>

<script>
function selectPreset(btn, preset) {
    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('preset').value = preset;
}
</script>
{% endblock %}
