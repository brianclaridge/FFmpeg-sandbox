{% if history %}
<ul class="history-list">
    {% for entry in history %}
    <li class="history-item">
        <div class="history-info">
            <strong>{{ entry.output_file }}</strong>
            <small>{{ entry.timestamp.strftime('%Y-%m-%d %H:%M') }} | {{ entry.preset }} | {{ entry.start_time }} - {{ entry.end_time }}</small>
        </div>
        <div class="history-actions">
            <button class="btn-small"
                    hx-get="/history/{{ entry.id }}/apply"
                    hx-target="#sliders-area"
                    hx-swap="innerHTML"
                    title="Apply settings">
                Apply
            </button>
            <button class="btn-small btn-play"
                    onclick="togglePlay(this, '/preview/{{ entry.output_file }}')"
                    title="Play">
                Play
            </button>
            <button class="btn-small btn-danger"
                    hx-delete="/history/{{ entry.id }}"
                    hx-target="#history-area"
                    hx-swap="innerHTML"
                    hx-confirm="Delete this entry and its file?"
                    title="Delete">
                X
            </button>
        </div>
    </li>
    {% endfor %}
</ul>
<audio id="history-player" style="display:none;"></audio>
<script>
var currentPlayer = document.getElementById('history-player');
var currentBtn = null;

function togglePlay(btn, src) {
    if (currentBtn === btn && !currentPlayer.paused) {
        currentPlayer.pause();
        btn.textContent = 'Play';
        return;
    }
    if (currentBtn && currentBtn !== btn) {
        currentBtn.textContent = 'Play';
    }
    currentPlayer.src = src;
    currentPlayer.play();
    btn.textContent = 'Stop';
    currentBtn = btn;
}

currentPlayer.onended = function() {
    if (currentBtn) currentBtn.textContent = 'Play';
};
</script>
{% else %}
<p class="placeholder">No processing history yet</p>
{% endif %}
