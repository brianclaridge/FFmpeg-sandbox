{% if history %}
<ul class="history-list">
    {% for entry in history %}
    <li class="history-item" data-entry-id="{{ entry.id }}">
        <div class="history-info">
            <strong>{{ entry.output_file }}</strong>
            <small>{{ entry.timestamp.strftime('%Y-%m-%d %H:%M') }} | {{ entry.start_time }} - {{ entry.end_time }}</small>
            <small>Vol: {{ entry.volume_preset }} | Tunnel: {{ entry.tunnel_preset }} | Freq: {{ entry.frequency_preset }}</small>
        </div>
        <div class="history-actions">
            <button class="btn-small"
                    hx-get="/history/{{ entry.id }}/apply"
                    hx-target="#effects-area"
                    hx-swap="innerHTML"
                    hx-vals="js:{filename: window.currentFilename || ''}"
                    onclick="selectHistoryItem(this)"
                    title="Apply settings">
                Apply
            </button>
            <button class="btn-small btn-play"
                    hx-get="/history/{{ entry.id }}/preview"
                    hx-target="#preview-area"
                    hx-swap="innerHTML"
                    onclick="selectHistoryItem(this)"
                    title="Play">
                Play
            </button>
            <button class="btn-small btn-danger"
                    hx-delete="/history/{{ entry.id }}"
                    hx-target="#history-area"
                    hx-swap="innerHTML"
                    hx-confirm="Delete this entry and its file?"
                    title="Delete">
                X
            </button>
        </div>
    </li>
    {% endfor %}
</ul>
<script>
function selectHistoryItem(btn) {
    document.querySelectorAll('.history-item').forEach(function(item) {
        item.classList.remove('history-item--selected');
    });
    var item = btn.closest('.history-item');
    if (item) {
        item.classList.add('history-item--selected');
    }
}
</script>
{% else %}
<p class="placeholder">No processing history yet</p>
{% endif %}
