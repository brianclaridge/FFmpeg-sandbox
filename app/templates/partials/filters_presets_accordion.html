<div id="filters-presets-accordion" class="accordion presets-accordion">
    {% if apply_success %}
    <div class="save-success-toast">
        <i class="fa-solid fa-check-circle"></i> Preset "{{ applied_preset_name }}" applied{% if chain_count > 1 %} ({{ chain_count }} in chain){% endif %}
    </div>
    {% endif %}

    <!-- Video Presets Section -->
    <div class="accordion-section {% if user_settings.active_category == 'video_presets' %}expanded{% endif %}">
        <div class="accordion-header"
             hx-get="/partials/presets-accordion/video_presets"
             hx-target="#filters-presets-accordion"
             hx-swap="outerHTML"
             hx-vals="js:{filename: window.currentFilename || '', current_category: '{{ user_settings.active_category }}'}">
            <span class="accordion-icon"><i class="fa-solid fa-film"></i></span>
            <span class="accordion-label">Video Presets</span>
            <span class="accordion-description">Retro and cinematic video effects{% if video_theme_chain %} ({{ video_theme_chain|length }} selected){% endif %}</span>
            <span class="accordion-indicator">{% if user_settings.active_category == 'video_presets' %}&#9660;{% else %}&#9654;{% endif %}</span>
        </div>
        {% if user_settings.active_category == 'video_presets' %}
        <div class="accordion-content">
            <div class="preset-cards">
                <!-- None option to clear video preset chain -->
                <div class="preset-card preset-card--none {% if not video_theme_chain %}preset-card--selected{% endif %}"
                     hx-post="/toggle-theme-preset/video/none"
                     hx-target="#filters-presets-accordion"
                     hx-swap="outerHTML"
                     hx-vals="js:{filename: window.currentFilename || ''}">
                    <div class="preset-card-icon">
                        <i class="fa-solid fa-ban"></i>
                    </div>
                    <div class="preset-card-content">
                        <span class="preset-card-name">Clear All</span>
                        <span class="preset-card-description">Remove all video presets</span>
                    </div>
                </div>
                {% for preset_key, preset in video_theme_presets.items() %}
                {% set chain_position = video_theme_chain.index(preset_key) + 1 if preset_key in video_theme_chain else 0 %}
                <div class="preset-card {% if chain_position > 0 %}preset-card--selected{% endif %}"
                     hx-post="/toggle-theme-preset/video/{{ preset_key }}"
                     hx-target="#filters-presets-accordion"
                     hx-swap="outerHTML"
                     hx-vals="js:{filename: window.currentFilename || ''}">
                    {% if chain_position > 0 %}
                    <span class="preset-chain-badge">{{ chain_position }}</span>
                    {% endif %}
                    <div class="preset-card-icon">
                        <i class="fa-solid {{ preset.icon or 'fa-video' }}"></i>
                    </div>
                    <div class="preset-card-content">
                        <span class="preset-card-name">{{ preset.name }}</span>
                        <span class="preset-card-description">{{ preset.description }}</span>
                    </div>
                </div>
                {% else %}
                <p class="no-presets">No video presets available</p>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Connector Line -->
    <div class="accordion-connector"></div>

    <!-- Audio Presets Section -->
    <div class="accordion-section {% if user_settings.active_category == 'audio_presets' %}expanded{% endif %}">
        <div class="accordion-header"
             hx-get="/partials/presets-accordion/audio_presets"
             hx-target="#filters-presets-accordion"
             hx-swap="outerHTML"
             hx-vals="js:{filename: window.currentFilename || '', current_category: '{{ user_settings.active_category }}'}">
            <span class="accordion-icon"><i class="fa-solid fa-record-vinyl"></i></span>
            <span class="accordion-label">Audio Presets</span>
            <span class="accordion-description">Vintage and stylized audio effects{% if audio_theme_chain %} ({{ audio_theme_chain|length }} selected){% endif %}</span>
            <span class="accordion-indicator">{% if user_settings.active_category == 'audio_presets' %}&#9660;{% else %}&#9654;{% endif %}</span>
        </div>
        {% if user_settings.active_category == 'audio_presets' %}
        <div class="accordion-content">
            <div class="preset-cards">
                <!-- None option to clear audio preset chain -->
                <div class="preset-card preset-card--none {% if not audio_theme_chain %}preset-card--selected{% endif %}"
                     hx-post="/toggle-theme-preset/audio/none"
                     hx-target="#filters-presets-accordion"
                     hx-swap="outerHTML"
                     hx-vals="js:{filename: window.currentFilename || ''}">
                    <div class="preset-card-icon">
                        <i class="fa-solid fa-ban"></i>
                    </div>
                    <div class="preset-card-content">
                        <span class="preset-card-name">Clear All</span>
                        <span class="preset-card-description">Remove all audio presets</span>
                    </div>
                </div>
                {% for preset_key, preset in audio_theme_presets.items() %}
                {% set chain_position = audio_theme_chain.index(preset_key) + 1 if preset_key in audio_theme_chain else 0 %}
                <div class="preset-card {% if chain_position > 0 %}preset-card--selected{% endif %}"
                     hx-post="/toggle-theme-preset/audio/{{ preset_key }}"
                     hx-target="#filters-presets-accordion"
                     hx-swap="outerHTML"
                     hx-vals="js:{filename: window.currentFilename || ''}">
                    {% if chain_position > 0 %}
                    <span class="preset-chain-badge">{{ chain_position }}</span>
                    {% endif %}
                    <div class="preset-card-icon">
                        <i class="fa-solid {{ preset.icon or 'fa-music' }}"></i>
                    </div>
                    <div class="preset-card-content">
                        <span class="preset-card-name">{{ preset.name }}</span>
                        <span class="preset-card-description">{{ preset.description }}</span>
                    </div>
                </div>
                {% else %}
                <p class="no-presets">No audio presets available</p>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Info Section -->
    <div class="presets-info">
        <p><i class="fa-solid fa-info-circle"></i> Click presets to add them to the chain. Click again to remove. Order matters - later presets override earlier ones for conflicting settings.</p>
    </div>
</div>
