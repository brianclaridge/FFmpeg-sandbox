{% if success %}
<div class="preview-success transcript-mode">
    <p>Transcript extracted!</p>
    <div class="transcript-info">
        <span class="transcript-source">
            {% if source_type == "url" %}
            <i class="fas fa-globe"></i> Fetched from source URL
            {% else %}
            <i class="fas fa-file-video"></i> Extracted from embedded subtitles
            {% endif %}
        </span>
        {% if subtitle_type and subtitle_type != "embedded" %}
        <span class="transcript-type">
            ({{ "Manual captions" if subtitle_type == "manual" else "Auto-generated captions" }})
        </span>
        {% endif %}
    </div>
    <div class="transcript-preview">
        {% if cues %}
        <div class="transcript-cues">
            {% for cue in cues %}
            <div class="transcript-cue" data-time="{{ cue.start_seconds }}">
                <a href="#" class="cue-timestamp" onclick="seekVideo({{ cue.start_seconds }}); return false;">
                    {{ cue.start_display }}
                </a>
                <span class="cue-text">{{ cue.text }}</span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <pre class="transcript-text">{{ transcript_text[:2000] }}{% if transcript_text|length > 2000 %}...{% endif %}</pre>
        {% endif %}
    </div>
    <div class="preview-actions">
        <a href="/preview/{{ output_file }}" download="{{ output_file }}" class="btn-secondary">
            <i class="fas fa-download"></i> Download Transcript
        </a>
    </div>
</div>

<script>
(function() {
    // Switch video to full input file for seeking
    var video = document.getElementById('clip-preview-video');
    var filename = window.currentFilename;
    if (video && filename) {
        var fullVideoUrl = '/input/' + encodeURIComponent(filename);
        if (video.src !== fullVideoUrl && !video.src.endsWith(encodeURIComponent(filename))) {
            video.src = fullVideoUrl;
            video.load();
        }
    }
})();

function seekVideo(seconds) {
    var video = document.getElementById('clip-preview-video');
    if (video) {
        video.currentTime = seconds;
        video.play();
    }
}
</script>
{% else %}
<div class="preview-error">
    <p>Transcript extraction failed</p>
    <pre>{{ error }}</pre>
</div>
{% endif %}
